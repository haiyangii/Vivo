<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Vivo商城-商品详情</title>
<link rel="short icon" href="images/logo.jpg">
<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/common.css">
<link rel="stylesheet" href="css/details.css">
</head>
<body>

<div id="login_info">

<div class="header_con">
     <div class="header">
          <div class ="welcome ">欢迎来到Vivo商城<span>|</span>vivo</div>
          <div class="login_on" v-if="onlogin">
            	    <a href="user.html" target="_blank">欢迎：<em>{{loginName}}</em></a>
                	<span>|</span>
                	<a href="register.html" target="_blank">注册</a>
           </div>
          <div class ="login_on" v-else="onlogin">
                 <a href="login.html" target="_blank">登录</a>
                 <span>|</span>
                 <a href="register.html">注册</a>
          </div>
           <div class="user_link ">
                    <span> | </span>
                    <a href="front/user.html" target="_blank">用户中心</a>
                    <span> | </span>
                    <a href="front/cart.html" target="_blank">我的购物车</a>
                    <span> | </span>
                    <a href="front/order.html" target="_blank">我的订单</a>
           </div> 
     </div>
</div>

<!-- 搜素框 -->
 <div class="search_bar clear">
 		<a href="index.html" class="logo fl"><img src="images/logo2.jpg"></a>
 		<div class="search_con fl">
        	<form>
                <input type="text" class="input_text fl" name="key_words" placeholder="搜索商品">
                <input type="submit" class="input_btn fr"  value="搜索">
            </form>
        </div>
 		<div class="guest_cart fr">
        	<a href="front/cart.html" class="cart_name fl" target="_blank">我的购物车</a>
            <div class="goods_count fl" id="show_count">{{cartCount}}</div>
        </div>
 </div>
</div>

<!--全部商品分类-->
    <!--手机分类-->
  <div class="classify_con clear">
     <div class="classify">
           <!-- 动态下拉框 -->
          <div class="subnav_con fl">
            	<h1 class="fl">vivo手机系列</h1>
            	<span></span>
                <ul class="subnav">
                    <li><a href="#model01" class="">NEX系列</a></li>
                    <li><a href="#model02" class="">X系列</a></li>
                    <li><a href="#model03" class="">Y系列</a></li>
                    <li><a href="#model04" class="">Z系列</a></li>
                    <li><a href="#model05" class="">S系列</a></li>
                    <li><a href="#model06" class="">U系列</a></li>
            	</ul>
            </div>
          <ul class="classifylist fl">
              <li class="interval"><a href="index.html" target="_blank">首页</a></li>
              
              <li class="interval"><a href="">手机</a></li>
              
              <li class="interval"><a href="">手机充电</a></li>
              
              <li class="interval"><a href="">手机配件</a></li>
              
              <li class="interval"><a href="">音乐设备</a></li>
          </ul>
     </div>
   </div>
   
  <div id="app">  
   <!-- 导航区 -->
   <div class="breadcrumb" id="breadcrumb">
     	<a href="javascript:void(0)">全部分类</a>
        <span>&gt;</span>
        <a href="javascript:void(0)">NEX系列</a>
        <span>&gt;</span>
        <a href="javascript:void(0)">{{goods.pname}}</a>
     </div>
   
     <!-- 商品展示 -->
     <div class="show_goods clear">
          <div class="show_goods_pic clear fl">
               <img  v-for="pic in pics" :src="pic">
                <div class="phone_price">
                       <span class="showprice">￥&nbsp;{{goods.price}}&nbsp;元</span>
                       <span class="jifen">购买即送2480积分</span>
                </div>
          </div>
           
          <div class="goods_info fl">
              <ul>
                  <li>
                      <div class="adver">
                           <h1>vivo&nbsp;{{goods.pname}}&nbsp;5G版&nbsp;{{goods.capacity}}G&nbsp;{{goods.color}}</h1>
                           <p>【现货首发：①下单享12期免息；②限时加赠半年延保；③vivo老用户咨询客服赠自拍杆礼品】 
                                                 约7.39mm超薄外观|约170g|前置4400万AF广角双摄|后置6400万超感光影像系统</p>
                     </div>
                  </li>
                  
                  <li>
                      <div class="banben">
                            <span class="btitle">版本</span>
                            <span class="phone_banben clear">vivo{{goods.pname}} {{goods.capacity}}G</span>
                      </div>
                  </li>
                  <li>
                       <div class="color">
                            <span class="ctitle">颜色</span>
                            <span class="phone_color clear">{{goods.color}}</span>
                       </div>
                  </li>
                  <li>
                       <div class="num">
                            <div class="num_name fl">数量：</div>
				            <div class="num_add fl">
				                    <a href="javascript:;" class="minus fl" @click="addNum(-1)">-</a>
									<input type="text" class="num_show fl" v-model="nums">
									<a href="javascript:;" class="add fl" @click="addNum(1)">+</a>
									<span class="exce fl">(限购5件)</span>
						    </div> 
                       </div>
                  </li>
                  <li>
                       <div class="paytype">
                            <input type="button" class="tocart" value="放入购物车" @click="addCart"/>
                            <input type="button" class="tobuy" value="立即购买"/>
                       </div>
                  </li>
                  <li>
                     <div class="select_info">
                          <p>&nbsp;&nbsp;总价:&nbsp;<span class="totalprice">￥&nbsp;{{goods.price*this.nums}}&nbsp;元</span>&nbsp;<span class="rrr">|</span>&nbsp;已选<span class="endpname">{{goods.pname}}</span>官方配件<span class="endnum">{{this.nums}}</span>件</p>
                     </div>
                  </li>
              </ul>
         </div>
     </div>
</div> 

<!--底部版权区-->
   <div class="login_bottom">
      <div class="bottom_style">
        <p><img src="images/下载.png">&nbsp;在线客服&nbsp;&nbsp;<img src="images/下载 (1).png">&nbsp;400-678-9688(24小时全国服务热线)</p>
        <p>COPYRIGHT ©2020 广东步步高电子工业有限公司 版权所有 保留一切权利 <span>|</span> 隐私政策 <span>|</span> 法律声明 <span>|</span> 粤B2-20080267 <span>|</span> 粤ICP备05100288号</p>
	  </div>
   </div>	
   
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/vue.js" type="text/javascript"></script>
<script src="js/axios.js" type="text/javascript"></script>
<script src="js/qs.js" type="text/javascript"></script>
<script src="js/checklogin.js" type="text/javascript"></script>

<script>
let vm = new Vue({
	el:"#app",
	data:{
		goods:{},
		nums:1,
		pics:[]
	},
	methods:{
		addNum:function(num){
			if(num == -1 && this.nums==1){//说明不能再减了
				return;
			}
			
			if(num == 1 && (this.nums >= this.goods.inventory || this.nums ==5)){//说明不能再加了
				return;
			}
			this.nums=parseInt(this.nums) + num;
		},
		addCart:function(){
			//先判断在购物车中是否存在->从购物车中判断
			if(!login.$data.loginId){
				
				alert("请先登录...");
				location.href="login.html";
				return;
			}
			
			//判断该商品在购物车中是否存在 ->从购物车中判断
			let lcarts = login.$data.carts;
			if(lcarts.length >0){//说明购物车中有数据
				for(let i=0,len=lcarts.length;i<len;i++){
					if(lcarts[i].pno == this.goods.pno){//说明这个商品已经购买过
						axios.post("cart",qs.stringify({op:"update",pno:this.goods.pno,num: this.nums, cno:lcarts[i].cno})).then(result => {
							if(result.data.code == 200){
								alert("加入购物车成功...");
								
							}else{
								alert("加入购物车失败")
							}
						})
						return;
					}
				}
			}
			
			axios.post("cart",qs.stringify({op:"add",pno:this.goods.pno, num: this.nums, uid:login.$data.loginId})).then(result =>{
				if(result.data.code == 200){
					login.$data.cartCount = login.$data.cartCount +1;//购物车中商品种类+1;
					
					//将这个新种类添加到cart中
					let newObj = {};
					newObj.cno = result.data.msg;
					newObj.pno = this.goods.pno;
					login.$data.carts.push(newObj);
					alert("加入购物车成功...");
					
				}else{
					alert("加入购物车失败...");
				}
			})
		}
	},
	mounted:function(){
		axios.all([getGoodsByGno()]).then(axios.spread((result) => {
			this.goods = result.data.data;
			
			this.pics = result.data.data.pics.split(";");
			
			this.$nextTick(function(){//第一次渲染后执行的代码
				showPics();
			})
		}));
	}
})

function getGoodsByGno(){
	//获取地址栏里的信息
	var hash= decodeURI(location.hash);//避免乱码
	if(hash == "" || hash.indexOf("&")<=0){
		location.href="index.html";
		return;
	}
	
	hash = hash.replace("#","").split("&");
	$("#goods_tname").text(hash[1]);
	console.info(login.$data.loginId);
	return axios.post("goods",qs.stringify({op:"findByPno",pno:hash[0]}));
}

function showPics(){
	var imglen = $("#goods_details_pic>img").length;
	
	if(imglen > 1){
		var i = 0;
		/*setTimeout(() =>{
			
		},milliseconde;) //指定时间后执行一次（只执行一次）
		
		*/
		setInterval(() => {
			$("#show_goods_pic>img").css("display","none");
			$("#show_goods_pic>img").eq(i).css("display","block");
			i = (i+1) % imglen;
		},2000);
	}
}

//立即购买
$("#buy_btn").click(function(){
	location.href="order.html";
});

</script>
</body>
</html>